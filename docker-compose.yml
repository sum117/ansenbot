name: ansenbot
version: '3.8'

services:
  ansenbot:
    build:
      context: .
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      DISCORD_BOT_TOKEN: ${DISCORD_BOT_TOKEN}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      POCKETBASE_URL: ${POCKETBASE_URL} # TODO: Figure out why this isn't statically defined ?
      POCKETBASE_ADMIN_EMAIL: ${POCKETBASE_ADMIN_EMAIL}
      POCKETBASE_ADMIN_PASSWORD: ${POCKETBASE_ADMIN_PASSWORD}
    image: ghcr.io/sum117/ansenbot:master
    restart: unless-stopped
  pocketbase:
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:8090/api/health || exit 1"]
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 30s
    image: ghcr.io/muchobien/pocketbase:0.15.3 # ! Shouldn't really want to use latest version.
    ports:
      - 8090:8090
    restart: unless-stopped
    volumes:
      - /pb_data:/pb_data
      - /pb_migrations/:/pb_migrations
